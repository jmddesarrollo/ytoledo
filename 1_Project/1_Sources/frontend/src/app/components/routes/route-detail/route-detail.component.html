<div class="route-detail-container">
  <!-- Header -->
  <div class="w3-row w3-margin-bottom">
    <div class="w3-col l8 m8 s12">
      <h2>{{ route?.name || 'Detalle de Ruta' }}</h2>
    </div>
    <div class="w3-col l4 m4 s12 w3-right-align">
      <button class="w3-button w3-light-grey w3-round w3-margin-right" (click)="goBack()">
        <i class="fa fa-arrow-left"></i> Volver
      </button>
      <button *ngIf="route && canEdit()" class="w3-button w3-orange w3-round w3-margin-right" (click)="editRoute()">
        <i class="fa fa-edit"></i> Editar
      </button>
      <button *ngIf="route && canEdit()" class="w3-button w3-red w3-round" (click)="deleteRoute()">
        <i class="fa fa-trash"></i> Eliminar
      </button>
    </div>
  </div>

  <!-- Loading indicator -->
  <div *ngIf="loading" class="w3-center w3-padding">
    <i class="fa fa-spinner fa-spin fa-2x"></i>
    <p>Cargando ruta...</p>
  </div>

  <!-- Error message -->
  <div *ngIf="errorMessage" class="w3-panel w3-red w3-round w3-margin-bottom">
    <p><i class="fa fa-exclamation-triangle"></i> {{ errorMessage }}</p>
  </div>

  <!-- Route details -->
  <div *ngIf="route && !loading" class="route-details">
    
    <!-- Información básica -->
    <div class="w3-card w3-white w3-margin-bottom">
      <div class="w3-container w3-padding">
        <h4 class="section-title">
          <i class="fa fa-info-circle"></i> Información Básica
        </h4>
        
        <div class="w3-row-padding">
          <div class="w3-col l6 m6 s12">
            <div class="detail-item">
              <label class="detail-label">Fecha:</label>
              <span class="detail-value">{{ formatDate(route.date) }}</span>
            </div>
            
            <div class="detail-item">
              <label class="detail-label">Punto de Inicio:</label>
              <span class="detail-value">{{ getStartPoint() }}</span>
            </div>
            
            <div class="detail-item">
              <label class="detail-label">Tipo de Ruta:</label>
              <span class="detail-value">{{ getRouteTypeLabel(route.type) }}</span>
            </div>
          </div>
          
          <div class="w3-col l6 m6 s12">
            <div class="detail-item">
              <label class="detail-label">Dificultad:</label>
              <span class="w3-tag w3-round detail-tag" [ngClass]="getDifficultyClass(route.difficulty)">
                {{ route.difficulty || 'No especificada' }}
              </span>
            </div>
            
            <div class="detail-item">
              <label class="detail-label">Distancia:</label>
              <span class="detail-value">{{ formatDistance(getDistanceKm()) }}</span>
            </div>
            
            <div class="detail-item">
              <label class="detail-label">Duración Estimada:</label>
              <span class="detail-value">{{ formatDuration() }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Descripción -->
    <div *ngIf="route.description" class="w3-card w3-white w3-margin-bottom">
      <div class="w3-container w3-padding">
        <h4 class="section-title">
          <i class="fa fa-file-text-o"></i> Descripción
        </h4>
        
        <div class="description-content">
          {{ route.description }}
        </div>
      </div>
    </div>

    <!-- Características técnicas -->
    <div class="w3-card w3-white w3-margin-bottom">
      <div class="w3-container w3-padding">
        <h4 class="section-title">
          <i class="fa fa-mountain"></i> Características Técnicas
        </h4>
        
        <div class="w3-row-padding">
          <div class="w3-col l3 m6 s12">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fa fa-arrows-h"></i>
              </div>
              <div class="stat-content">
                <div class="stat-value">{{ getDistanceKm() || '0' }}</div>
                <div class="stat-label">Kilómetros</div>
              </div>
            </div>
          </div>
          
          <div class="w3-col l3 m6 s12">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fa fa-arrow-up"></i>
              </div>
              <div class="stat-content">
                <div class="stat-value">{{ getElevationGain() || '0' }}</div>
                <div class="stat-label">Desnivel (+)</div>
              </div>
            </div>
          </div>
          
          <div class="w3-col l3 m6 s12">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fa fa-chevron-up"></i>
              </div>
              <div class="stat-content">
                <div class="stat-value">{{ getMaxHeight() || '0' }}</div>
                <div class="stat-label">Altura Máx (m)</div>
              </div>
            </div>
          </div>
          
          <div class="w3-col l3 m6 s12">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fa fa-chevron-down"></i>
              </div>
              <div class="stat-content">
                <div class="stat-value">{{ getMinHeight() || '0' }}</div>
                <div class="stat-label">Altura Mín (m)</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Mapa de Wikiloc embebido -->
    <div *ngIf="hasWikilocMapLink() || getWikilocLink()" class="w3-card w3-white w3-margin-bottom">
      <div class="w3-container w3-padding">
        <h4 class="section-title">
          <i class="fa fa-map"></i> Mapa de la Ruta
        </h4>
        
        <!-- Iframe del mapa si existe -->
        <div *ngIf="hasWikilocMapLink()" class="wikiloc-map-container">
          <div [innerHTML]="getWikilocMapLink()"></div>
        </div>
        
        <!-- Botón centrado para ver en Wikiloc -->
        <div *ngIf="getWikilocLink()" class="w3-center" [ngClass]="{'w3-margin-top': hasWikilocMapLink()}">
          <button class="w3-button w3-blue w3-round w3-large" (click)="openLink(getWikilocLink())">
            <i class="fa fa-map-marker"></i> Ver en Wikiloc
          </button>
        </div>
      </div>
    </div>

    <!-- Información de auditoría -->
    <div *ngIf="route.createdAt || route.updatedAt" class="w3-card w3-light-grey w3-margin-bottom">
      <div class="w3-container w3-padding">
        <h5 class="section-title-small">
          <i class="fa fa-clock-o"></i> Información del Sistema
        </h5>
        
        <div class="w3-row-padding">
          <div class="w3-col l6 m6 s12">
            <div *ngIf="route.createdAt" class="detail-item-small">
              <label class="detail-label-small">Creada:</label>
              <span class="detail-value-small">{{ formatDate(route.createdAt.toString()) }}</span>
            </div>
          </div>
          
          <div class="w3-col l6 m6 s12">
            <div *ngIf="route.updatedAt" class="detail-item-small">
              <label class="detail-label-small">Última modificación:</label>
              <span class="detail-value-small">{{ formatDate(route.updatedAt.toString()) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>